<link rel="stylesheet" href="web/css/navigation.css">
<div id="navImg" style="background:url({$img[0]['url']});height:700px;background-size:cover;background-position:center;background-repeat:no-repeat;">
  <a href="/">Retour</a>
  <img id="arrowLeft" class="fleche" style="left:5%;top:45%" src="./assets/imgs/fleche_gauche.png" onclick="changeSrcImg('left');"></img>
  <img id="arrowRight" class="fleche" style="right:5%;top:45%" src="./assets/imgs/fleche_droite.png" onclick="changeSrcImg('right');"></img>
  <img id="arrowForward" class="fleche" style="left:45%;top:5%" src="./assets/imgs/fleche_haut.png" onclick="changeSrcImg('forward');"></img>
  <img id="arrowBehind" class="fleche" style="left:45%;bottom:5%" src="./assets/imgs/fleche_bas.png" onclick="changeSrcImg('behind');"></img>
</div>
<script language="javascript">
  var imgIndex = 0;
  var encodedImg = {$encoded_img};
  var currentObj = encodedImg[imgIndex];
  displayArrows(currentObj);

  function loadPathfinding(placeName) {
    var img = {$encoded_img};
    var objToFind = null;
    for (var i = 0; i<img.length; i++) {
      var obj = img[i];
      if(obj.name == placeName) {
        objToFind = obj;
        break;
      }
    }
    console.log("OBJTOFIND = " + objToFind);

    var id = 0;
    var thisObj = objToFind;
    encodedImg = [];
    thisObj.forward = 0;
    thisObj.left = 0;
    thisObj.right = 0;
    encodedImg.push(thisObj);
    while(id != 1) {
      for (var i = 0; i<img.length; i++) {
        var obj = img[i];
        if(obj.id == thisObj.behind) {
          if(obj.forward == thisObj.id) {
            obj.right = 0;
            obj.left = 0;
          }
          else if (obj.left == thisObj.id) {
            obj.right = 0;
            obj.forward = 0;
          }
          else if (obj.right == thisObj.id) {
            obj.forward = 0;
            obj.left = 0;
          }

          objToFind = obj;
          id = obj.id;
          encodedImg.push(obj);
          break;
        }
      }
    }
    console.log("NEW IMGS = " + encodedImg);
  }

  function changeSrcImg(direction) {
    var currentObj = encodedImg[imgIndex];
    for (var i = 0; i<encodedImg.length; i++) {
      var obj = encodedImg[i];
      if(obj.id == currentObj[direction]) {
        currentObj = obj;
        imgIndex = i;
        break;
      }
    }
    document.getElementById("navImg").style.backgroundImage = "url(" + currentObj.url + ")";
    displayArrows(currentObj);
  }

  function displayArrows(obj) {
    if(obj.forward != 0) {
      document.getElementById("arrowForward").style.display = "block";
      for (var i = 0; i<encodedImg.length; i++) {
        if(obj.forward == encodedImg[i].id) {
          document.getElementById("arrowForward").title = encodedImg[i].name;
        }
      }
    }
    else {
      document.getElementById("arrowForward").style.display = "none";
    }

    if(obj.behind != 0) {
      document.getElementById("arrowBehind").style.display = "block";
      for (var i = 0; i<encodedImg.length; i++) {
        if(obj.behind == encodedImg[i].id) {
          document.getElementById("arrowBehind").title = encodedImg[i].name;
        }
      }
    }
    else {
      document.getElementById("arrowBehind").style.display = "none";
    }

    if(obj.left != 0) {
      document.getElementById("arrowLeft").style.display = "block";
      for (var i = 0; i<encodedImg.length; i++) {
        if(obj.left == encodedImg[i].id) {
          document.getElementById("arrowLeft").title = encodedImg[i].name;
        }
      }
    }
    else {
      document.getElementById("arrowLeft").style.display = "none";
    }

    if(obj.right != 0) {
      document.getElementById("arrowRight").style.display = "block";
      for (var i = 0; i<encodedImg.length; i++) {
        if(obj.right == encodedImg[i].id) {
          document.getElementById("arrowRight").title = encodedImg[i].name;
        }
      }
    }
    else {
      document.getElementById("arrowRight").style.display = "none";
    }
  }
</script>
